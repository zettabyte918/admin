"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6445],{6445:(P,p,a)=>{a.r(p),a.d(p,{MapPageModule:()=>l});var m=a(6895),h=a(433),n=a(5035),d=a(4126),b=a(655),o=a(8407),t=a(8256),f=a(1053);class c{constructor(e,r,i,v,y){Object.defineProperty(this,"formBuilder",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"alertController",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"redditService",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"router",{enumerable:!0,configurable:!0,writable:!0,value:v}),Object.defineProperty(this,"loadingCtrl",{enumerable:!0,configurable:!0,writable:!0,value:y}),Object.defineProperty(this,"map",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"pages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"posts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"table",{enumerable:!0,configurable:!0,writable:!0,value:"users"}),Object.defineProperty(this,"table2",{enumerable:!0,configurable:!0,writable:!0,value:"locationsmap"}),Object.defineProperty(this,"table3",{enumerable:!0,configurable:!0,writable:!0,value:"appointements"}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"category",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"per_page",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"order_id",{enumerable:!0,configurable:!0,writable:!0,value:"id"}),Object.defineProperty(this,"order_by",{enumerable:!0,configurable:!0,writable:!0,value:"desc"}),Object.defineProperty(this,"locationappointement",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"totaltech",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"totalappointemnts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lngevnt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"techs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postsevents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventid",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"appointement",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"technicienId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.page=1}ngOnInit(){return(0,b.mG)(this,void 0,void 0,function*(){const e=yield this.loadingCtrl.create({message:"Chargement..",spinner:"bubbles"});this.redditService.getDataBypage(this.page,this.table,this.per_page,this.order_id,this.order_by,this.category,this.status,this.filter).subscribe(r=>{console.log(r),e.dismiss(),this.posts=r.data,this.totaltech=r.total,console.log(this.totaltech),this.leafletMap()}),this.redditService.getDataAll(this.table2).subscribe(r=>{this.locationappointement=r.location,console.log(this.locationappointement),this.totalappointemnts=r.location.length})})}leafletMap(){this.map=new o.Map("mapId2").setView([50.8503396,4.3517103],9),o.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:"edupala.com"}).addTo(this.map);for(let e=0;e<this.totaltech;e++)this.addmarker(this.posts[e]);for(let e=0;e<this.totalappointemnts;e++)this.addmarker2(this.locationappointement[e])}ngOnDestroy(){this.map.remove()}addmarker(e){var r=o.icon({iconUrl:"./assets/icon/marker-icon.png",iconAnchor:[2,32]});const i=o.marker([e.lat,e.lng],{icon:r});i.bindPopup("<p>"+e.firstname+" "+e.lastname+"</p>"),this.map.addLayer(i)}addmarker2(e){var r=o.icon({iconUrl:"./assets/icon/marker-icon-2.png",iconAnchor:[2,10]});console.log(e);const i=o.marker([e.lat,e.lng],{icon:r});i.bindPopup("<p>"+e.title+"</p><p>"+e.company+"</p><p>"+e.start_at+"</p>"),this.eventid=e.item,this.getdataByid(),this.map.addLayer(i)}getdataByid(){return(0,b.mG)(this,void 0,void 0,function*(){console.log("detail event"),this.redditService.getByid(this.table,this.eventid).subscribe(e=>{this.postsevents=e.users,console.log(this.postsevents),this.techs=e.techs,this.appointement=[e.appointement],this.lngevnt=this.techs.lenght})})}onChangeType(e){this.technicienId=e.target.value}doUpdateAppointement(){return(0,b.mG)(this,void 0,void 0,function*(){var e=JSON.stringify({edited_by:this.technicienId,state:2});yield(yield this.alertController.create({header:"Enregistrement",message:"Voulez-vous vraiment ? ",buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:i=>{}},{text:"Oui",handler:()=>{this.redditService.update(this.table,this.eventid,e).toPromise().then(i=>{setTimeout(()=>{this.getdataByid()},400)})}}]})).present()})}doFinishedAppointement(){return(0,b.mG)(this,void 0,void 0,function*(){var e=JSON.stringify({state:3});yield(yield this.alertController.create({header:"Enregistrement",message:"Voulez-vous vraiment ? ",buttons:[{text:"Annuler",role:"cancel",cssClass:"secondary",handler:i=>{}},{text:"Oui",handler:()=>{this.redditService.update(this.table,this.eventid,e).toPromise().then(i=>{setTimeout(()=>{this.getdataByid()},1e3)})}}]})).present()})}}Object.defineProperty(c,"\u0275fac",{enumerable:!0,configurable:!0,writable:!0,value:function(e){return new(e||c)(t.Y36(h.qu),t.Y36(n.Br),t.Y36(f.I),t.Y36(d.F0),t.Y36(n.HT))}}),Object.defineProperty(c,"\u0275cmp",{enumerable:!0,configurable:!0,writable:!0,value:t.Xpm({type:c,selectors:[["app-map"]],decls:7,vars:1,consts:[["slot","start"],[3,"fullscreen"],["id","mapId2",2,"width","100%","height","100%"]],template:function(e,r){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-menu-button"),t.qZA(),t._UZ(4,"ion-title"),t.qZA()(),t.TgZ(5,"ion-content",1),t._UZ(6,"div",2),t.qZA()),2&e&&(t.xp6(5),t.Q6J("fullscreen",!0))},dependencies:[n.Sm,n.W2,n.Gu,n.fG,n.wd,n.sr],styles:[".map[_ngcontent-%COMP%]{position:absolute;top:0px;bottom:0px;width:100%;height:100%}leaflet-popup-content-wrapper[_ngcontent-%COMP%], .leaflet-popup-tip[_ngcontent-%COMP%]{background:white;color:#333;width:200px;box-shadow:0 3px 14px rgba(0,0,0,.4)}"]})});const g=[{path:"",component:c}];class u{}Object.defineProperty(u,"\u0275fac",{enumerable:!0,configurable:!0,writable:!0,value:function(e){return new(e||u)}}),Object.defineProperty(u,"\u0275mod",{enumerable:!0,configurable:!0,writable:!0,value:t.oAB({type:u})}),Object.defineProperty(u,"\u0275inj",{enumerable:!0,configurable:!0,writable:!0,value:t.cJS({imports:[d.Bz.forChild(g),d.Bz]})});class l{}Object.defineProperty(l,"\u0275fac",{enumerable:!0,configurable:!0,writable:!0,value:function(e){return new(e||l)}}),Object.defineProperty(l,"\u0275mod",{enumerable:!0,configurable:!0,writable:!0,value:t.oAB({type:l})}),Object.defineProperty(l,"\u0275inj",{enumerable:!0,configurable:!0,writable:!0,value:t.cJS({imports:[m.ez,h.u5,n.Pc,u]})})}}]);